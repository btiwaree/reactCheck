{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\nvar spawn = require('child_process').spawn;\nvar isPng = require('is-png');\nvar pngquant = require('pngquant-bin');\nvar through = require('through2');\n\nmodule.exports = function (opts) {\n\topts = opts || {};\n\n\treturn through.ctor({objectMode: true}, function (file, enc, cb) {\n\t\tif (file.isNull()) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tif (file.isStream()) {\n\t\t\tcb(new Error('Streaming is not supported'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isPng(file.contents)) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tvar args = ['-'];\n\t\tvar ret = [];\n\t\tvar err = '';\n\t\tvar len = 0;\n\n\t\tif (opts.floyd && typeof opts.floyd === 'number') {\n\t\t\targs.push('--floyd=' + opts.floyd);\n\t\t}\n\n\t\tif (opts.floyd && typeof opts.floyd === 'boolean') {\n\t\t\targs.push('--floyd');\n\t\t}\n\n\t\tif (opts.nofs) {\n\t\t\targs.push('--nofs');\n\t\t}\n\n\t\tif (opts.posterize) {\n\t\t\targs.push('--posterize', opts.posterize);\n\t\t}\n\n\t\tif (opts.quality) {\n\t\t\targs.push('--quality', opts.quality);\n\t\t}\n\n\t\tif (opts.speed) {\n\t\t\targs.push('--speed', opts.speed);\n\t\t}\n\n\t\tif (opts.verbose) {\n\t\t\targs.push('--verbose');\n\t\t}\n\n\t\tvar cp = spawn(pngquant, args);\n\n\t\tcp.stderr.setEncoding('utf8');\n\t\tcp.stderr.on('data', function (data) {\n\t\t\terr += data;\n\t\t});\n\n\t\tcp.stdout.on('data', function (data) {\n\t\t\tret.push(data);\n\t\t\tlen += data.length;\n\t\t});\n\n\t\tcp.on('error', function (err) {\n\t\t\terr.fileName = file.path;\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t});\n\n\t\tcp.on('close', function (code) {\n\t\t\tif (code && code !== 99) {\n\t\t\t\terr = new Error(err);\n\t\t\t\terr.fileName = file.path;\n\t\t\t\tcb(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (len < file.contents.length) {\n\t\t\t\tfile.contents = Buffer.concat(ret, len);\n\t\t\t}\n\n\t\t\tcb(null, file);\n\t\t});\n\n\t\tcp.stdin.end(file.contents);\n\t});\n};\n"]}