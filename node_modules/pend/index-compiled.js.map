{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA,OAAO,OAAP,GAAiB,IAAjB;;AAEA,SAAS,IAAT,GAAgB;AACd,OAAK,OAAL,GAAe,CAAf,CADc;AAEd,OAAK,GAAL,GAAW,QAAX,CAFc;AAGd,OAAK,SAAL,GAAiB,EAAjB,CAHc;AAId,OAAK,OAAL,GAAe,EAAf,CAJc;AAKd,OAAK,KAAL,GAAa,IAAb,CALc;CAAhB;;AAQA,KAAK,SAAL,CAAe,EAAf,GAAoB,UAAS,EAAT,EAAa;AAC/B,MAAI,KAAK,OAAL,GAAe,KAAK,GAAL,EAAU;AAC3B,WAAO,IAAP,EAAa,EAAb,EAD2B;GAA7B,MAEO;AACL,SAAK,OAAL,CAAa,IAAb,CAAkB,EAAlB,EADK;GAFP;CADkB;;AAQpB,KAAK,SAAL,CAAe,IAAf,GAAsB,UAAS,EAAT,EAAa;AACjC,MAAI,KAAK,OAAL,KAAiB,CAAjB,EAAoB;AACtB,OAAG,KAAK,KAAL,CAAH,CADsB;GAAxB,MAEO;AACL,SAAK,SAAL,CAAe,IAAf,CAAoB,EAApB,EADK;GAFP;CADoB;;AAQtB,KAAK,SAAL,CAAe,IAAf,GAAsB,YAAW;AAC/B,SAAO,SAAS,IAAT,CAAP,CAD+B;CAAX;;AAItB,SAAS,QAAT,CAAkB,IAAlB,EAAwB;AACtB,OAAK,OAAL,IAAgB,CAAhB,CADsB;AAEtB,MAAI,SAAS,KAAT,CAFkB;AAGtB,SAAO,IAAP,CAHsB;AAItB,WAAS,IAAT,CAAc,GAAd,EAAmB;AACjB,QAAI,MAAJ,EAAY,MAAM,IAAI,KAAJ,CAAU,uBAAV,CAAN,CAAZ;AACA,aAAS,IAAT,CAFiB;AAGjB,SAAK,KAAL,GAAa,KAAK,KAAL,IAAc,GAAd,CAHI;AAIjB,SAAK,OAAL,IAAgB,CAAhB,CAJiB;AAKjB,QAAI,KAAK,OAAL,CAAa,MAAb,GAAsB,CAAtB,IAA2B,KAAK,OAAL,GAAe,KAAK,GAAL,EAAU;AACtD,aAAO,IAAP,EAAa,KAAK,OAAL,CAAa,KAAb,EAAb,EADsD;KAAxD,MAEO,IAAI,KAAK,OAAL,KAAiB,CAAjB,EAAoB;AAC7B,UAAI,YAAY,KAAK,SAAL,CADa;AAE7B,WAAK,SAAL,GAAiB,EAAjB,CAF6B;AAG7B,gBAAU,OAAV,CAAkB,UAAlB,EAH6B;KAAxB;GAPT;AAaA,WAAS,UAAT,CAAoB,QAApB,EAA8B;AAC5B,aAAS,KAAK,KAAL,CAAT,CAD4B;GAA9B;CAjBF;;AAsBA,SAAS,MAAT,CAAgB,IAAhB,EAAsB,EAAtB,EAA0B;AACxB,KAAG,SAAS,IAAT,CAAH,EADwB;CAA1B","file":"index-compiled.js","sourcesContent":["module.exports = Pend;\n\nfunction Pend() {\n  this.pending = 0;\n  this.max = Infinity;\n  this.listeners = [];\n  this.waiting = [];\n  this.error = null;\n}\n\nPend.prototype.go = function(fn) {\n  if (this.pending < this.max) {\n    pendGo(this, fn);\n  } else {\n    this.waiting.push(fn);\n  }\n};\n\nPend.prototype.wait = function(cb) {\n  if (this.pending === 0) {\n    cb(this.error);\n  } else {\n    this.listeners.push(cb);\n  }\n};\n\nPend.prototype.hold = function() {\n  return pendHold(this);\n};\n\nfunction pendHold(self) {\n  self.pending += 1;\n  var called = false;\n  return onCb;\n  function onCb(err) {\n    if (called) throw new Error(\"callback called twice\");\n    called = true;\n    self.error = self.error || err;\n    self.pending -= 1;\n    if (self.waiting.length > 0 && self.pending < self.max) {\n      pendGo(self, self.waiting.shift());\n    } else if (self.pending === 0) {\n      var listeners = self.listeners;\n      self.listeners = [];\n      listeners.forEach(cbListener);\n    }\n  }\n  function cbListener(listener) {\n    listener(self.error);\n  }\n}\n\nfunction pendGo(self, fn) {\n  fn(pendHold(self));\n}\n"]}