{"version":3,"sources":["change-code.js"],"names":[],"mappings":"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","file":"change-code-compiled.js","sourcesContent":["if (process.argv.length === 2) {\n  var types = [ 'explicit', 'code', 'normal' ]\n  var codes = [ 0, 2, 'null' ]\n  var changes = [ 'nochange', 'change', 'code', 'twice', 'twicecode']\n  var handlers = [ 'sigexit', 'nosigexit' ]\n  var opts = []\n  types.forEach(function (type) {\n    var testCodes = type === 'normal' ? [ 0 ] : codes\n    testCodes.forEach(function (code) {\n      changes.forEach(function (change) {\n        handlers.forEach(function (handler) {\n          opts.push([type, code, change, handler].join(' '))\n        })\n      })\n    })\n  })\n\n  var results = {}\n\n  var exec = require('child_process').exec\n  run(opts.shift())\n} else {\n  var type = process.argv[2]\n  var code = +process.argv[3]\n  var change = process.argv[4]\n  var sigexit = process.argv[5] !== 'nosigexit'\n\n  if (sigexit) {\n    var onSignalExit = require('../../')\n    onSignalExit(listener)\n  } else {\n    process.on('exit', listener)\n  }\n\n  process.on('exit', function (code) {\n    console.error('first code=%j', code)\n  })\n\n  if (change !== 'nochange') {\n    process.once('exit', function (code) {\n      console.error('set code from %j to %j', code, 5)\n      if (change === 'code' || change === 'twicecode') {\n        process.exitCode = 5\n      } else {\n        process.exit(5)\n      }\n    })\n    if (change === 'twicecode' || change === 'twice') {\n      process.once('exit', function (code) {\n        code = process.exitCode || code\n        console.error('set code from %j to %j', code, code + 1)\n        process.exit(code + 1)\n      })\n    }\n  }\n\n  process.on('exit', function (code) {\n    console.error('second code=%j', code)\n  })\n\n  if (type === 'explicit') {\n    if (code || code === 0) {\n      process.exit(code)\n    } else {\n      process.exit()\n    }\n  } else if (type === 'code') {\n    process.exitCode = +code || 0\n  }\n}\n\nfunction listener (code, signal) {\n  signal = signal || null\n  console.log('%j', { code: code, signal: signal, exitCode: process.exitCode || 0 })\n}\n\nfunction run (opt) {\n  console.error(opt)\n  exec(process.execPath + ' ' + __filename + ' ' + opt, function (err, stdout, stderr) {\n    var res = JSON.parse(stdout)\n    if (err) {\n      res.actualCode = err.code\n      res.actualSignal = err.signal\n    } else {\n      res.actualCode = 0\n      res.actualSignal = null\n    }\n    res.stderr = stderr.trim().split('\\n')\n    results[opt] = res\n    if (opts.length) {\n      run(opts.shift())\n    } else {\n      console.log(JSON.stringify(results, null, 2))\n    }\n  })\n}\n"]}