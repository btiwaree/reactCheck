{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,QAAQ,QAAQ,eAAR,EAAyB,KAAzB;AACZ,IAAI,WAAW,QAAQ,UAAR,CAAX;AACJ,IAAI,QAAQ,QAAQ,QAAR,CAAR;AACJ,IAAI,UAAU,QAAQ,UAAR,CAAV;;AAEJ,OAAO,OAAP,GAAiB,UAAU,IAAV,EAAgB;AAChC,QAAO,QAAQ,EAAR,CADyB;;AAGhC,QAAO,QAAQ,IAAR,CAAa,EAAC,YAAY,IAAZ,EAAd,EAAiC,UAAU,IAAV,EAAgB,GAAhB,EAAqB,EAArB,EAAyB;AAChE,MAAI,KAAK,MAAL,EAAJ,EAAmB;AAClB,MAAG,IAAH,EAAS,IAAT,EADkB;AAElB,UAFkB;GAAnB;;AAKA,MAAI,KAAK,QAAL,EAAJ,EAAqB;AACpB,MAAG,IAAI,KAAJ,CAAU,4BAAV,CAAH,EADoB;AAEpB,UAFoB;GAArB;;AAKA,MAAI,CAAC,MAAM,KAAK,QAAL,CAAP,EAAuB;AAC1B,MAAG,IAAH,EAAS,IAAT,EAD0B;AAE1B,UAF0B;GAA3B;;AAKA,MAAI,OAAO,CAAC,IAAD,CAAP,CAhB4D;AAiBhE,MAAI,MAAM,EAAN,CAjB4D;AAkBhE,MAAI,MAAM,CAAN,CAlB4D;;AAoBhE,MAAI,KAAK,UAAL,EAAiB;AACpB,QAAK,IAAL,CAAU,aAAV,EADoB;GAArB;;AAIA,MAAI,KAAK,MAAM,QAAN,EAAgB,IAAhB,CAAL,CAxB4D;;AA0BhE,KAAG,MAAH,CAAU,WAAV,CAAsB,MAAtB,EA1BgE;AA2BhE,KAAG,MAAH,CAAU,EAAV,CAAa,MAAb,EAAqB,UAAU,IAAV,EAAgB;AACpC,OAAI,MAAM,IAAI,KAAJ,CAAU,IAAV,CAAN,CADgC;AAEpC,OAAI,QAAJ,GAAe,KAAK,IAAL,CAFqB;AAGpC,MAAG,GAAH,EAHoC;AAIpC,UAJoC;GAAhB,CAArB,CA3BgE;;AAkChE,KAAG,MAAH,CAAU,EAAV,CAAa,MAAb,EAAqB,UAAU,IAAV,EAAgB;AACpC,OAAI,IAAJ,CAAS,IAAT,EADoC;AAEpC,UAAO,KAAK,MAAL,CAF6B;GAAhB,CAArB,CAlCgE;;AAuChE,KAAG,EAAH,CAAM,OAAN,EAAe,UAAU,GAAV,EAAe;AAC7B,OAAI,QAAJ,GAAe,KAAK,IAAL,CADc;AAE7B,MAAG,GAAH,EAF6B;AAG7B,UAH6B;GAAf,CAAf,CAvCgE;;AA6ChE,KAAG,EAAH,CAAM,OAAN,EAAe,YAAY;AAC1B,OAAI,MAAM,KAAK,QAAL,CAAc,MAAd,EAAsB;AAC/B,SAAK,QAAL,GAAgB,OAAO,MAAP,CAAc,GAAd,EAAmB,GAAnB,CAAhB,CAD+B;IAAhC;;AAIA,MAAG,IAAH,EAAS,IAAT,EAL0B;GAAZ,CAAf,CA7CgE;;AAqDhE,KAAG,KAAH,CAAS,GAAT,CAAa,KAAK,QAAL,CAAb,CArDgE;EAAzB,CAAxC,CAHgC;CAAhB","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar spawn = require('child_process').spawn;\nvar gifsicle = require('gifsicle');\nvar isGif = require('is-gif');\nvar through = require('through2');\n\nmodule.exports = function (opts) {\n\topts = opts || {};\n\n\treturn through.ctor({objectMode: true}, function (file, enc, cb) {\n\t\tif (file.isNull()) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tif (file.isStream()) {\n\t\t\tcb(new Error('Streaming is not supported'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isGif(file.contents)) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tvar args = ['-w'];\n\t\tvar ret = [];\n\t\tvar len = 0;\n\n\t\tif (opts.interlaced) {\n\t\t\targs.push('--interlace');\n\t\t}\n\n\t\tvar cp = spawn(gifsicle, args);\n\n\t\tcp.stderr.setEncoding('utf8');\n\t\tcp.stderr.on('data', function (data) {\n\t\t\tvar err = new Error(data);\n\t\t\terr.fileName = file.path;\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t});\n\n\t\tcp.stdout.on('data', function (data) {\n\t\t\tret.push(data);\n\t\t\tlen += data.length;\n\t\t});\n\n\t\tcp.on('error', function (err) {\n\t\t\terr.fileName = file.path;\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t});\n\n\t\tcp.on('close', function () {\n\t\t\tif (len < file.contents.length) {\n\t\t\t\tfile.contents = Buffer.concat(ret, len);\n\t\t\t}\n\n\t\t\tcb(null, file);\n\t\t});\n\n\t\tcp.stdin.end(file.contents);\n\t});\n};\n"]}