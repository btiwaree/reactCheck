{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AACA,IAAI,aAAa,QAAQ,aAAR,CAAb;AACJ,IAAI,QAAQ,QAAQ,QAAR,CAAR;AACJ,IAAI,UAAU,QAAQ,aAAR,CAAV;AACJ,IAAI,UAAU,QAAQ,UAAR,CAAV;;AAEJ,OAAO,OAAP,GAAiB,UAAU,IAAV,EAAgB;AAChC,QAAO,QAAQ,EAAR,CADyB;;AAGhC,QAAO,QAAQ,IAAR,CAAa,EAAC,YAAY,IAAZ,EAAd,EAAiC,UAAU,IAAV,EAAgB,GAAhB,EAAqB,EAArB,EAAyB;AAChE,MAAI,KAAK,MAAL,EAAJ,EAAmB;AAClB,MAAG,IAAH,EAAS,IAAT,EADkB;AAElB,UAFkB;GAAnB;;AAKA,MAAI,KAAK,QAAL,EAAJ,EAAqB;AACpB,MAAG,IAAI,KAAJ,CAAU,4BAAV,CAAH,EADoB;AAEpB,UAFoB;GAArB;;AAKA,MAAI,CAAC,MAAM,KAAK,QAAL,CAAP,EAAuB;AAC1B,MAAG,IAAH,EAAS,IAAT,EAD0B;AAE1B,UAF0B;GAA3B;;AAKA,MAAI,aAAa,IAAI,UAAJ,EAAb,CAhB4D;AAiBhE,MAAI,OAAO,CAAC,QAAD,EAAW,KAAX,EAAkB,UAAlB,EAA8B,QAA9B,EAAwC,MAAxC,CAAP,CAjB4D;AAkBhE,MAAI,oBAAoB,KAAK,iBAAL,IAA0B,CAA1B,CAlBwC;;AAoBhE,MAAI,OAAO,iBAAP,KAA6B,QAA7B,EAAuC;AAC1C,QAAK,IAAL,CAAU,IAAV,EAAgB,iBAAhB,EAD0C;GAA3C;;AAIA,aACE,GADF,CACM,OADN,EACe,KAAK,MAAL,CAAY,CAAC,MAAD,EAAS,WAAW,IAAX,EAAT,EAA4B,WAAW,GAAX,EAA5B,CAAZ,CADf,EAEE,GAFF,CAEM,KAAK,QAAL,EAAe,UAAU,GAAV,EAAe,GAAf,EAAoB;AACvC,OAAI,GAAJ,EAAS;AACR,QAAI,QAAJ,GAAe,KAAK,IAAL,CADP;AAER,OAAG,GAAH,EAFQ;AAGR,WAHQ;IAAT;;AAMA,OAAI,IAAI,MAAJ,GAAa,KAAK,QAAL,CAAc,MAAd,EAAsB;AACtC,SAAK,QAAL,GAAgB,GAAhB,CADsC;IAAvC;;AAIA,MAAG,IAAH,EAAS,IAAT,EAXuC;GAApB,CAFrB,CAxBgE;EAAzB,CAAxC,CAHgC;CAAhB","file":"index-compiled.js","sourcesContent":["'use strict';\nvar ExecBuffer = require('exec-buffer');\nvar isPng = require('is-png');\nvar optipng = require('optipng-bin');\nvar through = require('through2');\n\nmodule.exports = function (opts) {\n\topts = opts || {};\n\n\treturn through.ctor({objectMode: true}, function (file, enc, cb) {\n\t\tif (file.isNull()) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tif (file.isStream()) {\n\t\t\tcb(new Error('Streaming is not supported'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isPng(file.contents)) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tvar execBuffer = new ExecBuffer();\n\t\tvar args = ['-strip', 'all', '-clobber', '-force', '-fix'];\n\t\tvar optimizationLevel = opts.optimizationLevel || 2;\n\n\t\tif (typeof optimizationLevel === 'number') {\n\t\t\targs.push('-o', optimizationLevel);\n\t\t}\n\n\t\texecBuffer\n\t\t\t.use(optipng, args.concat(['-out', execBuffer.dest(), execBuffer.src()]))\n\t\t\t.run(file.contents, function (err, buf) {\n\t\t\t\tif (err) {\n\t\t\t\t\terr.fileName = file.path;\n\t\t\t\t\tcb(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (buf.length < file.contents.length) {\n\t\t\t\t\tfile.contents = buf;\n\t\t\t\t}\n\n\t\t\t\tcb(null, file);\n\t\t\t});\n\t});\n};\n"]}