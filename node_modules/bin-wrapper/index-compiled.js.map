{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar fs = require('fs');\nvar path = require('path');\nvar lazyReq = require('lazy-req')(require);\nvar binCheck = lazyReq('bin-check');\nvar binVersionCheck = lazyReq('bin-version-check');\nvar Download = lazyReq('download');\nvar osFilterObj = lazyReq('os-filter-obj');\n\n/**\n * Initialize a new `BinWrapper`\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction BinWrapper(opts) {\n\tif (!(this instanceof BinWrapper)) {\n\t\treturn new BinWrapper(opts);\n\t}\n\n\tthis.opts = opts || {};\n\tthis.opts.strip = this.opts.strip <= 0 ? 0 : !this.opts.strip ? 1 : this.opts.strip;\n}\n\nmodule.exports = BinWrapper;\n\n/**\n * Get or set files to download\n *\n * @param {String} src\n * @param {String} os\n * @param {String} arch\n * @api public\n */\n\nBinWrapper.prototype.src = function (src, os, arch) {\n\tif (!arguments.length) {\n\t\treturn this._src;\n\t}\n\n\tthis._src = this._src || [];\n\tthis._src.push({\n\t\turl: src,\n\t\tos: os,\n\t\tarch: arch\n\t});\n\n\treturn this;\n};\n\n/**\n * Get or set the destination\n *\n * @param {String} dest\n * @api public\n */\n\nBinWrapper.prototype.dest = function (dest) {\n\tif (!arguments.length) {\n\t\treturn this._dest;\n\t}\n\n\tthis._dest = dest;\n\treturn this;\n};\n\n/**\n * Get or set the binary\n *\n * @param {String} bin\n * @api public\n */\n\nBinWrapper.prototype.use = function (bin) {\n\tif (!arguments.length) {\n\t\treturn this._use;\n\t}\n\n\tthis._use = bin;\n\treturn this;\n};\n\n/**\n * Get or set a semver range to test the binary against\n *\n * @param {String} range\n * @api public\n */\n\nBinWrapper.prototype.version = function (range) {\n\tif (!arguments.length) {\n\t\treturn this._version;\n\t}\n\n\tthis._version = range;\n\treturn this;\n};\n\n/**\n * Get path to the binary\n *\n * @api public\n */\n\nBinWrapper.prototype.path = function () {\n\treturn path.join(this.dest(), this.use());\n};\n\n/**\n * Run\n *\n * @param {Array} cmd\n * @param {Function} cb\n * @api public\n */\n\nBinWrapper.prototype.run = function (cmd, cb) {\n\tif (typeof cmd === 'function' && !cb) {\n\t\tcb = cmd;\n\t\tcmd = ['--version'];\n\t}\n\n\tthis.findExisting(function (err) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.opts.skipCheck) {\n\t\t\tcb();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCheck(cmd, cb);\n\t}.bind(this));\n};\n\n/**\n * Run binary check\n *\n * @param {Array} cmd\n * @param {Function} cb\n * @api private\n */\n\nBinWrapper.prototype.runCheck = function (cmd, cb) {\n\tbinCheck()(this.path(), cmd, function (err, works) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!works) {\n\t\t\tcb(new Error('The `' + this.path() + '` binary doesn\\'t seem to work correctly'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.version()) {\n\t\t\treturn binVersionCheck()(this.path(), this.version(), cb);\n\t\t}\n\n\t\tcb();\n\t}.bind(this));\n};\n\n/**\n * Find existing files\n *\n * @param {Function} cb\n * @api private\n */\n\nBinWrapper.prototype.findExisting = function (cb) {\n\tfs.stat(this.path(), function (err) {\n\t\tif (err && err.code === 'ENOENT') {\n\t\t\tthis.download(cb);\n\t\t\treturn;\n\t\t}\n\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\tcb();\n\t}.bind(this));\n};\n\n/**\n * Download files\n *\n * @param {Function} cb\n * @api private\n */\n\nBinWrapper.prototype.download = function (cb) {\n\tvar files = osFilterObj()(this.src());\n\tvar download = new Download()({\n\t\textract: true,\n\t\tmode: '755',\n\t\tstrip: this.opts.strip\n\t});\n\n\tif (!files.length) {\n\t\tcb(new Error('No binary found matching your system. It\\'s probably not supported.'));\n\t\treturn;\n\t}\n\n\tfiles.forEach(function (file) {\n\t\tdownload.get(file.url);\n\t});\n\n\tdownload\n\t\t.dest(this.dest())\n\t\t.run(cb);\n};\n"]}