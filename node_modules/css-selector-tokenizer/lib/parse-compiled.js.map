{"version":3,"sources":["parse.js"],"names":[],"mappings":"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","file":"parse-compiled.js","sourcesContent":["\"use strict\";\r\n\r\nvar Parser = require(\"fastparse\");\r\n\r\nfunction unescape(str) {\r\n\treturn str.replace(/\\\\(.)/g, \"$1\");\r\n}\r\n\r\nfunction commentMatch(match, content) {\r\n\tthis.selector.nodes.push({\r\n\t\ttype: \"comment\",\r\n\t\tcontent: content\r\n\t});\r\n}\r\n\r\nfunction typeMatch(type) {\r\n\treturn function(match, name) {\r\n\t\tthis.selector.nodes.push({\r\n\t\t\ttype: type,\r\n\t\t\tname: unescape(name)\r\n\t\t});\r\n\t};\r\n}\r\n\r\nfunction pseudoClassStartMatch(match, name) {\r\n\tvar newToken = {\r\n\t\ttype: \"pseudo-class\",\r\n\t\tname: unescape(name),\r\n\t\tcontent: \"\"\r\n\t};\r\n\tthis.selector.nodes.push(newToken);\r\n\tthis.token = newToken;\r\n\tthis.brackets = 1;\r\n\treturn \"inBrackets\";\r\n}\r\n\r\nfunction nestedPseudoClassStartMatch(match, name, after) {\r\n\tvar newSelector = {\r\n\t\ttype: \"selector\",\r\n\t\tnodes: []\r\n\t};\r\n\tvar newToken = {\r\n\t\ttype: \"nested-pseudo-class\",\r\n\t\tname: unescape(name),\r\n\t\tnodes: [newSelector]\r\n\t};\r\n\tif(after) {\r\n\t\tnewSelector.before = after;\r\n\t}\r\n\tthis.selector.nodes.push(newToken);\r\n\tthis.stack.push(this.root);\r\n\tthis.root = newToken;\r\n\tthis.selector = newSelector;\r\n}\r\n\r\nfunction nestedEnd(match, before) {\r\n\tif(this.stack.length > 0) {\r\n\t\tif(before) {\r\n\t\t\tthis.selector.after = before;\r\n\t\t}\r\n\t\tthis.root = this.stack.pop();\r\n\t\tthis.selector = this.root.nodes[this.root.nodes.length - 1];\r\n\t} else {\r\n\t\tthis.selector.nodes.push({\r\n\t\t\ttype: \"invalid\",\r\n\t\t\tvalue: match\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction operatorMatch(match, before, operator, after) {\r\n\tvar token = {\r\n\t\ttype: \"operator\",\r\n\t\toperator: operator\r\n\t};\r\n\tif(before) {\r\n\t\ttoken.before = before;\r\n\t}\r\n\tif(after) {\r\n\t\ttoken.after = after;\r\n\t}\r\n\tthis.selector.nodes.push(token);\r\n}\r\n\r\nfunction spacingMatch(match) {\r\n\tthis.selector.nodes.push({\r\n\t\ttype: \"spacing\",\r\n\t\tvalue: match\r\n\t});\r\n}\r\n\r\nfunction elementMatch(match, namespace, name) {\r\n\tvar newToken = {\r\n\t\ttype: \"element\",\r\n\t\tname: unescape(name)\r\n\t};\r\n\r\n\tif(namespace) {\r\n\t\tnewToken.namespace = unescape(namespace.substr(0, namespace.length - 1));\r\n\t}\r\n\tthis.selector.nodes.push(newToken);\r\n}\r\n\r\nfunction universalMatch(match, namespace) {\r\n\tvar newToken = {\r\n\t\ttype: \"universal\"\r\n\t};\r\n\tif(namespace) {\r\n\t\tnewToken.namespace = unescape(namespace.substr(0, namespace.length - 1));\r\n\t}\r\n\tthis.selector.nodes.push(newToken);\r\n}\r\n\r\nfunction attributeMatch(match, content) {\r\n\tthis.selector.nodes.push({\r\n\t\ttype: \"attribute\",\r\n\t\tcontent: content\r\n\t});\r\n}\r\n\r\nfunction invalidMatch(match) {\r\n\tthis.selector.nodes.push({\r\n\t\ttype: \"invalid\",\r\n\t\tvalue: match\r\n\t});\r\n}\r\n\r\nfunction irrelevantSpacingStartMatch(match) {\r\n\tthis.selector.before = match;\r\n}\r\n\r\nfunction irrelevantSpacingEndMatch(match) {\r\n\tthis.selector.after = match;\r\n}\r\n\r\nfunction nextSelectorMatch(match, before, after) {\r\n\tvar newSelector = {\r\n\t\ttype: \"selector\",\r\n\t\tnodes: []\r\n\t};\r\n\tif(before) {\r\n\t\tthis.selector.after = before;\r\n\t}\r\n\tif(after) {\r\n\t\tnewSelector.before = after;\r\n\t}\r\n\tthis.root.nodes.push(newSelector);\r\n\tthis.selector = newSelector;\r\n}\r\n\r\nfunction addToCurrent(match) {\r\n\tthis.token.content += match;\r\n}\r\n\r\nfunction bracketStart(match) {\r\n\tthis.token.content += match;\r\n\tthis.brackets++;\r\n}\r\n\r\nfunction bracketEnd(match) {\r\n\tif(--this.brackets === 0) {\r\n\t\treturn \"selector\";\r\n\t}\r\n\tthis.token.content += match;\r\n}\r\n\r\nvar parser = new Parser({\r\n\tselector: {\r\n\t\t\"/\\\\*([\\\\s\\\\S]*?)\\\\*/\": commentMatch,\r\n\t\t\"\\\\.((?:\\\\\\\\.|[A-Za-z_\\\\-])(?:\\\\\\\\.|[A-Za-z_\\\\-0-9])*)\": typeMatch(\"class\"),\r\n\t\t\"#((?:\\\\\\\\.|[A-Za-z_\\\\-])(?:\\\\\\\\.|[A-Za-z_\\\\-0-9])*)\": typeMatch(\"id\"),\r\n\t\t\":(not|matches|has|local|global)\\\\((\\\\s*)\": nestedPseudoClassStartMatch,\r\n\t\t\":((?:\\\\\\\\.|[A-Za-z_\\\\-0-9])+)\\\\(\": pseudoClassStartMatch,\r\n\t\t\":((?:\\\\\\\\.|[A-Za-z_\\\\-0-9])+)\": typeMatch(\"pseudo-class\"),\r\n\t\t\"::((?:\\\\\\\\.|[A-Za-z_\\\\-0-9])+)\": typeMatch(\"pseudo-element\"),\r\n\t\t\"(\\\\*\\\\|)((?:\\\\\\\\.|[A-Za-z_\\\\-0-9])+)\": elementMatch,\r\n\t\t\"(\\\\*\\\\|)\\\\*\": universalMatch,\r\n\t\t\"((?:\\\\\\\\.|[A-Za-z_\\\\-0-9])*\\\\|)?\\\\*\": universalMatch,\r\n\t\t\"((?:\\\\\\\\.|[A-Za-z_\\\\-0-9])*\\\\|)?((?:\\\\\\\\.|[A-Za-z_\\\\-])(?:\\\\\\\\.|[A-Za-z_\\\\-0-9])*)\": elementMatch,\r\n\t\t\"\\\\[([^\\\\]]+)\\\\]\": attributeMatch,\r\n\t\t\"(\\\\s*)\\\\)\": nestedEnd,\r\n\t\t\"(\\\\s*)((?:\\\\|\\\\|)|(?:>>)|[>+~])(\\\\s*)\": operatorMatch,\r\n\t\t\"(\\\\s*),(\\\\s*)\": nextSelectorMatch,\r\n\t\t\"\\\\s+$\": irrelevantSpacingEndMatch,\r\n\t\t\"^\\\\s+\": irrelevantSpacingStartMatch,\r\n\t\t\"\\\\s+\": spacingMatch,\r\n\t\t\".\": invalidMatch\r\n\t},\r\n\tinBrackets: {\r\n\t\t\"/\\\\*[\\\\s\\\\S]*?\\\\*/\": addToCurrent,\r\n\t\t\"\\\"([^\\\\\\\\\\\"]|\\\\\\\\.)*\\\"\": addToCurrent,\r\n\t\t\"'([^\\\\\\\\']|\\\\\\\\.)*'\": addToCurrent,\r\n\t\t\"[^()'\\\"/]+\": addToCurrent,\r\n\t\t\"\\\\(\": bracketStart,\r\n\t\t\"\\\\)\": bracketEnd,\r\n\t\t\".\": addToCurrent\r\n\t}\r\n});\r\n\r\nfunction parse(str) {\r\n\tvar selectorNode = {\r\n\t\ttype: \"selector\",\r\n\t\tnodes: []\r\n\t};\r\n\tvar rootNode = {\r\n\t\ttype: \"selectors\",\r\n\t\tnodes: [\r\n\t\t\tselectorNode\r\n\t\t]\r\n\t};\r\n\tparser.parse(\"selector\", str, {\r\n\t\tstack: [],\r\n\t\troot: rootNode,\r\n\t\tselector: selectorNode\r\n\t});\r\n\treturn rootNode;\r\n}\r\n\r\nmodule.exports = parse;\r\n"]}