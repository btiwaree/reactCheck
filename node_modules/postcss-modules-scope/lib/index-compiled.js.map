{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar _postcss = require('postcss');\n\nvar _postcss2 = _interopRequireDefault(_postcss);\n\nvar _cssSelectorTokenizer = require('css-selector-tokenizer');\n\nvar _cssSelectorTokenizer2 = _interopRequireDefault(_cssSelectorTokenizer);\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction getSingleLocalNamesForComposes(selectors) {\n  return selectors.nodes.map(function (node) {\n    if (node.type !== 'selector' || node.nodes.length !== 1) {\n      throw new Error('composition is only allowed when selector is single :local class name not in \"' + _cssSelectorTokenizer2['default'].stringify(selectors) + '\"');\n    }\n    node = node.nodes[0];\n    if (node.type !== 'nested-pseudo-class' || node.name !== 'local' || node.nodes.length !== 1) {\n      throw new Error('composition is only allowed when selector is single :local class name not in \"' + _cssSelectorTokenizer2['default'].stringify(selectors) + '\", \"' + _cssSelectorTokenizer2['default'].stringify(node) + '\" is weird');\n    }\n    node = node.nodes[0];\n    if (node.type !== 'selector' || node.nodes.length !== 1) {\n      throw new Error('composition is only allowed when selector is single :local class name not in \"' + _cssSelectorTokenizer2['default'].stringify(selectors) + '\", \"' + _cssSelectorTokenizer2['default'].stringify(node) + '\" is weird');\n    }\n    node = node.nodes[0];\n    if (node.type !== 'class') {\n      // 'id' is not possible, because you can't compose ids\n      throw new Error('composition is only allowed when selector is single :local class name not in \"' + _cssSelectorTokenizer2['default'].stringify(selectors) + '\", \"' + _cssSelectorTokenizer2['default'].stringify(node) + '\" is weird');\n    }\n    return node.name;\n  });\n}\n\nvar processor = _postcss2['default'].plugin('postcss-modules-scope', function (options) {\n  return function (css) {\n    var generateScopedName = options && options.generateScopedName || processor.generateScopedName;\n\n    var exports = {};\n\n    function exportScopedName(name) {\n      var scopedName = generateScopedName(name, css.source.input.from, css.source.input.css);\n      exports[name] = exports[name] || [];\n      if (exports[name].indexOf(scopedName) < 0) {\n        exports[name].push(scopedName);\n      }\n      return scopedName;\n    }\n\n    function localizeNode(node) {\n      var newNode = Object.create(node);\n      switch (node.type) {\n        case 'selector':\n          newNode.nodes = node.nodes.map(localizeNode);\n          return newNode;\n        case 'class':\n        case 'id':\n          var scopedName = exportScopedName(node.name);\n          newNode.name = scopedName;\n          return newNode;\n      }\n      throw new Error(node.type + ' (\"' + _cssSelectorTokenizer2['default'].stringify(node) + '\") is not allowed in a :local block');\n    }\n\n    function traverseNode(node) {\n      switch (node.type) {\n        case 'nested-pseudo-class':\n          if (node.name === 'local') {\n            if (node.nodes.length !== 1) {\n              throw new Error('Unexpected comma (\",\") in :local block');\n            }\n            return localizeNode(node.nodes[0]);\n          }\n        /* falls through */\n        case 'selectors':\n        case 'selector':\n          var newNode = Object.create(node);\n          newNode.nodes = node.nodes.map(traverseNode);\n          return newNode;\n      }\n      return node;\n    }\n\n    // Find any :import and remember imported names\n    var importedNames = {};\n    css.walkRules(function (rule) {\n      if (/^:import\\(.+\\)$/.test(rule.selector)) {\n        rule.walkDecls(function (decl) {\n          importedNames[decl.prop] = true;\n        });\n      }\n    });\n\n    // Find any :local classes\n    css.walkRules(function (rule) {\n      var selector = _cssSelectorTokenizer2['default'].parse(rule.selector);\n      var newSelector = traverseNode(selector);\n      rule.selector = _cssSelectorTokenizer2['default'].stringify(newSelector);\n      rule.walkDecls(/composes|compose-with/, function (decl) {\n        var localNames = getSingleLocalNamesForComposes(selector);\n        var classes = decl.value.split(/\\s+/);\n        classes.forEach(function (className) {\n          var global = /^global\\(([^\\)]+)\\)$/.exec(className);\n          if (global) {\n            localNames.forEach(function (exportedName) {\n              exports[exportedName].push(global[1]);\n            });\n          } else if (hasOwnProperty.call(importedNames, className)) {\n            localNames.forEach(function (exportedName) {\n              exports[exportedName].push(className);\n            });\n          } else if (hasOwnProperty.call(exports, className)) {\n            localNames.forEach(function (exportedName) {\n              exports[className].forEach(function (item) {\n                exports[exportedName].push(item);\n              });\n            });\n          } else {\n            throw decl.error('referenced class name \"' + className + '\" in ' + decl.prop + ' not found');\n          }\n        });\n        decl.remove();\n      });\n\n      rule.walkDecls(function (decl) {\n        var tokens = decl.value.split(/(,|'[^']*'|\"[^\"]*\")/);\n        tokens = tokens.map(function (token, idx) {\n          if (idx === 0 || tokens[idx - 1] === ',') {\n            var localMatch = /^(\\s*):local\\s*\\((.+?)\\)/.exec(token);\n            if (localMatch) {\n              return localMatch[1] + exportScopedName(localMatch[2]) + token.substr(localMatch[0].length);\n            } else {\n              return token;\n            }\n          } else {\n            return token;\n          }\n        });\n        decl.value = tokens.join('');\n      });\n    });\n\n    // Find any :local keyframes\n    css.walkAtRules(function (atrule) {\n      if (/keyframes$/.test(atrule.name)) {\n        var localMatch = /^\\s*:local\\s*\\((.+?)\\)\\s*$/.exec(atrule.params);\n        if (localMatch) {\n          atrule.params = exportScopedName(localMatch[1]);\n        }\n      }\n    });\n\n    // If we found any :locals, insert an :export rule\n    var exportedNames = Object.keys(exports);\n    if (exportedNames.length > 0) {\n      css.append(_postcss2['default'].rule({\n        selector: ':export',\n        nodes: exportedNames.map(function (exportedName) {\n          return _postcss2['default'].decl({\n            prop: exportedName,\n            value: exports[exportedName].join(' '),\n            raws: { before: '\\n  ' },\n            _autoprefixerDisabled: true\n          });\n        })\n      }));\n    }\n  };\n});\n\nprocessor.generateScopedName = function (exportedName, path) {\n  var sanitisedPath = path.replace(/\\.[^\\.\\/\\\\]+$/, '').replace(/[\\W_]+/g, '_').replace(/^_|_$/g, '');\n  return '_' + sanitisedPath + '__' + exportedName;\n};\n\nexports['default'] = processor;\nmodule.exports = exports['default'];"]}