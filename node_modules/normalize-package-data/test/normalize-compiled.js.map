{"version":3,"sources":["normalize.js"],"names":[],"mappings":"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","file":"normalize-compiled.js","sourcesContent":["var tap = require(\"tap\")\nvar fs = require(\"fs\")\nvar path = require(\"path\")\n\nvar normalize = require(\"../lib/normalize\")\nvar warningMessages = require(\"../lib/warning_messages.json\")\nvar safeFormat = require(\"../lib/safe_format\")\n\nvar rpjPath = path.resolve(__dirname,\"./fixtures/read-package-json.json\")\n\ntap.test(\"normalize some package data\", function(t) {\n  var packageData = require(rpjPath)\n  var warnings = []\n  normalize(packageData, function(warning) {\n    warnings.push(warning)\n  })\n  // there's no readme data in this particular object\n  t.equal( warnings.length, 1, \"There's exactly one warning.\")\n  fs.readFile(rpjPath, function(err, data) {\n    if(err) throw err\n    // Various changes have been made\n    t.notEqual(packageData, JSON.parse(data), \"Output is different from input.\")\n    t.end()\n  })\n})\n\ntap.test(\"runs without passing warning function\", function(t) {\n  var packageData = require(rpjPath)\n  fs.readFile(rpjPath, function(err, data) {\n    if(err) throw err\n    normalize(JSON.parse(data))\n    t.ok(true, \"If you read this, this means I'm still alive.\")\n    t.end()\n  })\n})\n\ntap.test(\"empty object\", function(t) {\n  var packageData = {}\n  var expect =\n    { name: '',\n      version: '',\n      readme: 'ERROR: No README data found!',\n      _id: '@' }\n\n  var warnings = []\n  function warn(m) {\n    warnings.push(m)\n  }\n  normalize(packageData, warn)\n  t.same(packageData, expect)\n  t.same(warnings, [\n    warningMessages.missingDescription,\n    warningMessages.missingRepository,\n    warningMessages.missingReadme,\n    warningMessages.missingLicense\n  ])\n  t.end()\n})\n\ntap.test(\"core module name\", function(t) {\n  var warnings = []\n  function warn(m) {\n    warnings.push(m)\n  }\n  var a\n  normalize(a={\n    name: \"http\",\n    readme: \"read yourself how about\",\n    homepage: 123,\n    bugs: \"what is this i don't even\",\n    repository: \"Hello.\"\n  }, warn)\n\n  var expect = [\n      safeFormat(warningMessages.conflictingName, 'http'),\n      warningMessages.nonEmailUrlBugsString,\n      warningMessages.emptyNormalizedBugs,\n      warningMessages.nonUrlHomepage,\n      warningMessages.missingLicense\n      ]\n  t.same(warnings, expect)\n  t.end()\n})\n\ntap.test(\"urls required\", function(t) {\n  var warnings = []\n  function warn(w) {\n    warnings.push(w)\n  }\n  normalize({\n    bugs: {\n      url: \"/1\",\n      email: \"not an email address\"\n    }\n  }, warn)\n  var a\n  normalize(a={\n    readme: \"read yourself how about\",\n    homepage: 123,\n    bugs: \"what is this i don't even\",\n    repository: \"Hello.\"\n  }, warn)\n\n  console.error(a)\n\n  var expect =\n    [ warningMessages.missingDescription,\n      warningMessages.missingRepository,\n      warningMessages.nonUrlBugsUrlField,\n      warningMessages.nonEmailBugsEmailField,\n      warningMessages.emptyNormalizedBugs,\n      warningMessages.missingReadme,\n      warningMessages.missingLicense,\n      warningMessages.nonEmailUrlBugsString,\n      warningMessages.emptyNormalizedBugs,\n      warningMessages.nonUrlHomepage,\n      warningMessages.missingLicense]\n  t.same(warnings, expect)\n  t.end()\n})\n\ntap.test(\"homepage field must start with a protocol.\", function(t) {\n  var warnings = []\n  function warn(w) {\n    warnings.push(w)\n  }\n  var a\n  normalize(a={\n    homepage: 'example.org'\n  }, warn)\n\n  console.error(a)\n\n  var expect =\n    [ warningMessages.missingDescription,\n      warningMessages.missingRepository,\n      warningMessages.missingReadme,\n      warningMessages.missingProtocolHomepage,\n      warningMessages.missingLicense]\n  t.same(warnings, expect)\n  t.same(a.homepage, 'http://example.org')\n  t.end()\n})\n\ntap.test(\"license field should be a valid SPDX expression\", function(t) {\n  var warnings = []\n  function warn(w) {\n    warnings.push(w)\n  }\n  var a\n  normalize(a={\n    license: 'Apache 2'\n  }, warn)\n\n  console.error(a)\n\n  var expect =\n    [ warningMessages.missingDescription,\n      warningMessages.missingRepository,\n      warningMessages.missingReadme,\n      warningMessages.invalidLicense]\n  t.same(warnings, expect)\n  t.end()\n})\n\ntap.test(\"gist bugs url\", function(t) {\n  var d = {\n    repository: \"git@gist.github.com:123456.git\"\n  }\n  normalize(d)\n  t.same(d.repository, { type: 'git', url: 'git+ssh://git@gist.github.com/123456.git' })\n  t.same(d.bugs, { url: 'https://gist.github.com/123456' })\n  t.end();\n});\n\ntap.test(\"singularize repositories\", function(t) {\n  var d = {repositories:[\"git@gist.github.com:123456.git\"]}\n  normalize(d)\n  t.same(d.repository, { type: 'git', url: 'git+ssh://git@gist.github.com/123456.git' })\n  t.end()\n});\n\ntap.test(\"treat visionmedia/express as github repo\", function(t) {\n  var d = {repository: {type: \"git\", url: \"visionmedia/express\"}}\n  normalize(d)\n  t.same(d.repository, { type: \"git\", url: \"git+https://github.com/visionmedia/express.git\" })\n  t.end()\n});\n\ntap.test(\"treat isaacs/node-graceful-fs as github repo\", function(t) {\n  var d = {repository: {type: \"git\", url: \"isaacs/node-graceful-fs\"}}\n  normalize(d)\n  t.same(d.repository, { type: \"git\", url: \"git+https://github.com/isaacs/node-graceful-fs.git\" })\n  t.end()\n});\n\ntap.test(\"homepage field will set to github url if repository is a github repo\", function(t) {\n  var a\n  normalize(a={\n    repository: { type: \"git\", url: \"https://github.com/isaacs/node-graceful-fs\" }\n  })\n  t.same(a.homepage, 'https://github.com/isaacs/node-graceful-fs#readme')\n  t.end()\n})\n\ntap.test(\"homepage field will set to github gist url if repository is a gist\", function(t) {\n  var a\n  normalize(a={\n    repository: { type: \"git\", url: \"git@gist.github.com:123456.git\" }\n  })\n  t.same(a.homepage, 'https://gist.github.com/123456')\n  t.end()\n})\n\ntap.test(\"homepage field will set to github gist url if repository is a shorthand reference\", function(t) {\n  var a\n  normalize(a={\n    repository: { type: \"git\", url: \"sindresorhus/chalk\" }\n  })\n  t.same(a.homepage, 'https://github.com/sindresorhus/chalk#readme')\n  t.end()\n})\n\ntap.test(\"don't mangle github shortcuts in dependencies\", function(t) {\n  var d = {dependencies: {\"node-graceful-fs\": \"isaacs/node-graceful-fs\"}}\n  normalize(d)\n  t.same(d.dependencies, {\"node-graceful-fs\": \"github:isaacs/node-graceful-fs\" })\n  t.end()\n});\n\ntap.test(\"deprecation warning for array in dependencies fields\", function(t) {\n  var a\n  var warnings = []\n  function warn(w) {\n    warnings.push(w)\n  }\n  normalize(a={\n    dependencies: [],\n    devDependencies: [],\n    optionalDependencies: []\n  }, warn)\n  t.ok(~warnings.indexOf(safeFormat(warningMessages.deprecatedArrayDependencies, 'dependencies')), \"deprecation warning\")\n  t.ok(~warnings.indexOf(safeFormat(warningMessages.deprecatedArrayDependencies, 'devDependencies')), \"deprecation warning\")\n  t.ok(~warnings.indexOf(safeFormat(warningMessages.deprecatedArrayDependencies, 'optionalDependencies')), \"deprecation warning\")\n  t.end()\n})\n"]}