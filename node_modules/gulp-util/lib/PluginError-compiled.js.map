{"version":3,"sources":["PluginError.js"],"names":[],"mappings":"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","file":"PluginError-compiled.js","sourcesContent":["var util = require('util');\nvar arrayDiffer = require('array-differ');\nvar arrayUniq = require('array-uniq');\nvar chalk = require('chalk');\nvar objectAssign = require('object-assign');\n\nvar nonEnumberableProperties = ['name', 'message', 'stack'];\nvar propertiesNotToDisplay = nonEnumberableProperties.concat(['plugin', 'showStack', 'showProperties', '__safety', '_stack']);\n\n// wow what a clusterfuck\nvar parseOptions = function(plugin, message, opt) {\n  opt = opt || {};\n  if (typeof plugin === 'object') {\n    opt = plugin;\n  } else {\n    if (message instanceof Error) {\n      opt.error = message;\n    } else if (typeof message === 'object') {\n      opt = message;\n    } else {\n      opt.message = message;\n    }\n    opt.plugin = plugin;\n  }\n\n  return objectAssign({\n    showStack: false,\n    showProperties: true\n  }, opt);\n};\n\nfunction PluginError(plugin, message, opt) {\n  if (!(this instanceof PluginError)) throw new Error('Call PluginError using new');\n\n  Error.call(this);\n\n  var options = parseOptions(plugin, message, opt);\n  var self = this;\n\n  // if options has an error, grab details from it\n  if (options.error) {\n    // These properties are not enumerable, so we have to add them explicitly.\n    arrayUniq(Object.keys(options.error).concat(nonEnumberableProperties))\n      .forEach(function(prop) {\n        self[prop] = options.error[prop];\n      });\n  }\n\n  var properties = ['name', 'message', 'fileName', 'lineNumber', 'stack', 'showStack', 'showProperties', 'plugin'];\n\n  // options object can override\n  properties.forEach(function(prop) {\n    if (prop in options) this[prop] = options[prop];\n  }, this);\n\n  // defaults\n  if (!this.name) this.name = 'Error';\n\n  if (!this.stack) {\n    // Error.captureStackTrace appends a stack property which relies on the toString method of the object it is applied to.\n    // Since we are using our own toString method which controls when to display the stack trace if we don't go through this\n    // safety object, then we'll get stack overflow problems.\n    var safety = {\n      toString: function() {\n        return this._messageWithDetails() + '\\nStack:';\n      }.bind(this)\n    };\n    Error.captureStackTrace(safety, arguments.callee || this.constructor);\n    this.__safety = safety;\n  }\n\n  if (!this.plugin) throw new Error('Missing plugin name');\n  if (!this.message) throw new Error('Missing error message');\n}\n\nutil.inherits(PluginError, Error);\n\nPluginError.prototype._messageWithDetails = function() {\n  var messageWithDetails = 'Message:\\n    ' + this.message;\n  var details = this._messageDetails();\n\n  if (details !== '') {\n    messageWithDetails += '\\n' + details;\n  }\n\n  return messageWithDetails;\n};\n\nPluginError.prototype._messageDetails = function() {\n  if (!this.showProperties) {\n    return '';\n  }\n\n  var properties = arrayDiffer(Object.keys(this), propertiesNotToDisplay);\n\n  if (properties.length === 0) {\n    return '';\n  }\n\n  var self = this;\n  properties = properties.map(function stringifyProperty(prop) {\n    return '    ' + prop + ': ' + self[prop];\n  });\n\n  return 'Details:\\n' + properties.join('\\n');\n};\n\nPluginError.prototype.toString = function () {\n  var sig = chalk.red(this.name) + ' in plugin \\'' + chalk.cyan(this.plugin) + '\\'';\n  var detailsWithStack = function(stack) {\n    return this._messageWithDetails() + '\\nStack:\\n' + stack;\n  }.bind(this);\n\n  var msg;\n  if (this.showStack) {\n    if (this.__safety) { // There is no wrapped error, use the stack captured in the PluginError ctor\n      msg = this.__safety.stack;\n    } else if (this._stack) {\n      msg = detailsWithStack(this._stack);\n    } else { // Stack from wrapped error\n      msg = detailsWithStack(this.stack);\n    }\n  } else {\n    msg = this._messageWithDetails();\n  }\n\n  return sig + '\\n' + msg;\n};\n\nmodule.exports = PluginError;\n"]}