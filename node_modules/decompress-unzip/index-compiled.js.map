{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,KAAK,QAAQ,IAAR,CAAL;AACJ,IAAI,QAAQ,QAAQ,QAAR,CAAR;AACJ,IAAI,WAAW,QAAQ,WAAR,CAAX;AACJ,IAAI,gBAAgB,QAAQ,iBAAR,CAAhB;AACJ,IAAI,YAAY,QAAQ,YAAR,CAAZ;AACJ,IAAI,UAAU,QAAQ,UAAR,CAAV;AACJ,IAAI,QAAQ,QAAQ,OAAR,CAAR;AACJ,IAAI,QAAQ,QAAQ,OAAR,CAAR;;AAEJ,OAAO,OAAP,GAAiB,UAAU,IAAV,EAAgB;AAChC,QAAO,QAAQ,EAAR,CADyB;AAEhC,MAAK,KAAL,GAAa,OAAO,KAAK,KAAL,CAAP,IAAsB,CAAtB,CAFmB;;AAIhC,QAAO,QAAQ,GAAR,CAAY,UAAU,IAAV,EAAgB,GAAhB,EAAqB,EAArB,EAAyB;AAC3C,MAAI,OAAO,IAAP,CADuC;;AAG3C,MAAI,KAAK,MAAL,EAAJ,EAAmB;AAClB,MAAG,IAAH,EAAS,IAAT,EADkB;AAElB,UAFkB;GAAnB;;AAKA,MAAI,KAAK,QAAL,EAAJ,EAAqB;AACpB,MAAG,IAAI,KAAJ,CAAU,4BAAV,CAAH,EADoB;AAEpB,UAFoB;GAArB;;AAKA,MAAI,CAAC,KAAK,OAAL,IAAgB,CAAC,MAAM,KAAK,QAAL,CAAP,EAAuB;AAC3C,MAAG,IAAH,EAAS,IAAT,EAD2C;AAE3C,UAF2C;GAA5C;;AAKA,QAAM,UAAN,CAAiB,KAAK,QAAL,EAAe,UAAU,GAAV,EAAe,OAAf,EAAwB;AACvD,OAAI,QAAQ,CAAR,CADmD;;AAGvD,OAAI,GAAJ,EAAS;AACR,OAAG,GAAH,EADQ;AAER,WAFQ;IAAT;;AAKA,WAAQ,EAAR,CAAW,OAAX,EAAoB,EAApB,EARuD;AASvD,WAAQ,EAAR,CAAW,OAAX,EAAoB,UAAU,KAAV,EAAiB;AACpC,QAAI,WAAW,UAAU,MAAM,QAAN,EAAgB,KAAK,KAAL,CAArC,CADgC;;AAGpC,QAAI,aAAa,GAAb,EAAkB;AACrB,SAAI,EAAE,KAAF,KAAY,QAAQ,UAAR,EAAoB;AACnC,WADmC;MAApC;;AAIA,YALqB;KAAtB;;AAQA,QAAI,OAAO,IAAI,GAAG,KAAH,EAAX,CAXgC;AAYpC,QAAI,OAAO,KAAC,CAAM,sBAAN,IAAgC,EAAhC,GAAsC,MAAvC,CAZyB;;AAcpC,SAAK,IAAL,GAAY,IAAZ,CAdoC;;AAgBpC,QAAI,MAAM,cAAN,EAAJ,EAA4B;AAC3B,UAAK,KAAL,GAAa,MAAM,cAAN,EAAb,CAD2B;KAA5B;;AAIA,QAAI,MAAM,QAAN,CAAe,MAAf,CAAsB,MAAM,QAAN,CAAe,MAAf,GAAwB,CAAxB,CAAtB,KAAqD,GAArD,EAA0D;AAC7D,SAAI,CAAC,IAAD,EAAO;AACV,UAAI,QAAJ,CAAa,IAAb,EAAmB,WAAnB,CAA+B,IAA/B,EADU;MAAX;;AAIA,UAAK,IAAL,CAAU,IAAI,KAAJ,CAAU;AACnB,YAAM,QAAN;AACA,YAAM,IAAN;MAFS,CAAV,EAL6D;;AAU7D,SAAI,EAAE,KAAF,KAAY,QAAQ,UAAR,EAAoB;AACnC,WADmC;MAApC;;AAIA,YAd6D;KAA9D;;AAiBA,YAAQ,cAAR,CAAuB,KAAvB,EAA8B,UAAU,GAAV,EAAe,UAAf,EAA2B;AACxD,SAAI,GAAJ,EAAS;AACR,SAAG,GAAH,EADQ;AAER,aAFQ;MAAT;;AAKA,mBAAc,UAAd,EAA0B,IAA1B,EAAgC,UAAU,GAAV,EAAe,IAAf,EAAqB;AACpD,UAAI,GAAJ,EAAS;AACR,UAAG,GAAH,EADQ;AAER,cAFQ;OAAT;;AAKA,UAAI,CAAC,IAAD,EAAO;AACV,WAAI,QAAJ,CAAa,IAAb,EAAmB,MAAnB,CAA0B,IAA1B,EADU;OAAX;;AAIA,WAAK,IAAL,CAAU,IAAI,KAAJ,CAAU;AACnB,iBAAU,IAAV;AACA,aAAM,QAAN;AACA,aAAM,IAAN;OAHS,CAAV,EAVoD;;AAgBpD,UAAI,EAAE,KAAF,KAAY,QAAQ,UAAR,EAAoB;AACnC,YADmC;OAApC;MAhB+B,CAAhC,CANwD;KAA3B,CAA9B,CArCoC;IAAjB,CAApB,CATuD;GAAxB,CAAhC,CAlB2C;EAAzB,CAAnB,CAJgC;CAAhB","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar fs = require('fs');\nvar isZip = require('is-zip');\nvar StatMode = require('stat-mode');\nvar readAllStream = require('read-all-stream');\nvar stripDirs = require('strip-dirs');\nvar through = require('through2');\nvar Vinyl = require('vinyl');\nvar yauzl = require('yauzl');\n\nmodule.exports = function (opts) {\n\topts = opts || {};\n\topts.strip = Number(opts.strip) || 0;\n\n\treturn through.obj(function (file, enc, cb) {\n\t\tvar self = this;\n\n\t\tif (file.isNull()) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tif (file.isStream()) {\n\t\t\tcb(new Error('Streaming is not supported'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!file.extract || !isZip(file.contents)) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tyauzl.fromBuffer(file.contents, function (err, zipFile) {\n\t\t\tvar count = 0;\n\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tzipFile.on('error', cb);\n\t\t\tzipFile.on('entry', function (entry) {\n\t\t\t\tvar filePath = stripDirs(entry.fileName, opts.strip);\n\n\t\t\t\tif (filePath === '.') {\n\t\t\t\t\tif (++count === zipFile.entryCount) {\n\t\t\t\t\t\tcb();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar stat = new fs.Stats();\n\t\t\t\tvar mode = (entry.externalFileAttributes >> 16) & 0xFFFF;\n\n\t\t\t\tstat.mode = mode;\n\n\t\t\t\tif (entry.getLastModDate()) {\n\t\t\t\t\tstat.mtime = entry.getLastModDate();\n\t\t\t\t}\n\n\t\t\t\tif (entry.fileName.charAt(entry.fileName.length - 1) === '/') {\n\t\t\t\t\tif (!mode) {\n\t\t\t\t\t\tnew StatMode(stat).isDirectory(true);\n\t\t\t\t\t}\n\n\t\t\t\t\tself.push(new Vinyl({\n\t\t\t\t\t\tpath: filePath,\n\t\t\t\t\t\tstat: stat\n\t\t\t\t\t}));\n\n\t\t\t\t\tif (++count === zipFile.entryCount) {\n\t\t\t\t\t\tcb();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tzipFile.openReadStream(entry, function (err, readStream) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tcb(err);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treadAllStream(readStream, null, function (err, data) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcb(err);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!mode) {\n\t\t\t\t\t\t\tnew StatMode(stat).isFile(true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.push(new Vinyl({\n\t\t\t\t\t\t\tcontents: data,\n\t\t\t\t\t\t\tpath: filePath,\n\t\t\t\t\t\t\tstat: stat\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tif (++count === zipFile.entryCount) {\n\t\t\t\t\t\t\tcb();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n};\n"]}