{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\nvar fs = require('fs');\nvar archiveType = require('archive-type');\nvar execSeries = require('exec-series');\nvar Decompress = require('decompress');\nvar Download = require('download');\nvar rimraf = require('rimraf');\nvar tempfile = require('tempfile');\nvar urlRegex = require('url-regex');\n\n/**\n * Initialize new `BinBuild`\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction BinBuild(opts) {\n\tif (!(this instanceof BinBuild)) {\n\t\treturn new BinBuild(opts);\n\t}\n\n\tthis.opts = opts || {};\n\tthis.tmp = tempfile();\n\n\tif (this.opts.strip <= 0) {\n\t\tthis.opts.strip = 0;\n\t} else if (!this.opts.strip) {\n\t\tthis.opts.strip = 1;\n\t}\n}\n\nmodule.exports = BinBuild;\n\n/**\n * Define the source archive to download\n *\n * @param {String} str\n * @api public\n */\n\nBinBuild.prototype.src = function (str) {\n\tif (!arguments.length) {\n\t\treturn this._src;\n\t}\n\n\tthis._src = str;\n\treturn this;\n};\n\n/**\n * Add a command to run\n *\n * @param {String} str\n * @api public\n */\n\nBinBuild.prototype.cmd = function (str) {\n\tif (!arguments.length) {\n\t\treturn this._cmd;\n\t}\n\n\tthis._cmd = this._cmd || [];\n\tthis._cmd.push(str);\n\n\treturn this;\n};\n\n/**\n * Build\n *\n * @param {Function} cb\n * @api public\n */\n\nBinBuild.prototype.run = function (cb) {\n\tcb = cb || function () {};\n\n\tif (urlRegex().test(this.src())) {\n\t\treturn this.download(function (err) {\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.exec(this.tmp, cb);\n\t\t}.bind(this));\n\t}\n\n\tfs.readFile(this.src(), function (err, data) {\n\t\tif (err && err.code !== 'EISDIR') {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\tif (archiveType(data)) {\n\t\t\tthis.extract(function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tcb(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.exec(this.tmp, cb);\n\t\t\t}.bind(this));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.exec(this.src(), cb);\n\t}.bind(this));\n};\n\n/**\n * Execute commands\n *\n * @param {String} cwd\n * @param {Function} cb\n * @api private\n */\n\nBinBuild.prototype.exec = function (cwd, cb) {\n\texecSeries(this.cmd(), {cwd: cwd}, function (err) {\n\t\tif (err) {\n\t\t\terr.message = [this.cmd().join(' && '), err.message].join('\\n');\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\trimraf(this.tmp, cb);\n\t}.bind(this));\n};\n\n/**\n * Decompress source\n *\n * @param {Function} cb\n * @api private\n */\n\nBinBuild.prototype.extract = function (cb) {\n\tvar decompress = new Decompress({\n\t\tmode: '777',\n\t\tstrip: this.opts.strip\n\t});\n\n\tdecompress\n\t\t.src(this.src())\n\t\t.dest(this.tmp)\n\t\t.run(cb);\n};\n\n/**\n * Download source file\n *\n * @param {Function} cb\n * @api private\n */\n\nBinBuild.prototype.download = function (cb) {\n\tvar download = new Download({\n\t\tstrip: this.opts.strip,\n\t\textract: true,\n\t\tmode: '777'\n\t});\n\n\tdownload\n\t\t.get(this.src())\n\t\t.dest(this.tmp)\n\t\t.run(cb);\n};\n"]}