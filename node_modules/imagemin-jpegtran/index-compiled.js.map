{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,QAAQ,QAAQ,eAAR,EAAyB,KAAzB;AACZ,IAAI,QAAQ,QAAQ,QAAR,CAAR;AACJ,IAAI,WAAW,QAAQ,cAAR,CAAX;AACJ,IAAI,UAAU,QAAQ,UAAR,CAAV;;AAEJ,OAAO,OAAP,GAAiB,UAAU,IAAV,EAAgB;AAChC,QAAO,QAAQ,EAAR,CADyB;;AAGhC,QAAO,QAAQ,IAAR,CAAa,EAAC,YAAY,IAAZ,EAAd,EAAiC,UAAU,IAAV,EAAgB,GAAhB,EAAqB,EAArB,EAAyB;AAChE,MAAI,KAAK,MAAL,EAAJ,EAAmB;AAClB,MAAG,IAAH,EAAS,IAAT,EADkB;AAElB,UAFkB;GAAnB;;AAKA,MAAI,KAAK,QAAL,EAAJ,EAAqB;AACpB,MAAG,IAAI,KAAJ,CAAU,4BAAV,CAAH,EADoB;AAEpB,UAFoB;GAArB;;AAKA,MAAI,CAAC,MAAM,KAAK,QAAL,CAAP,EAAuB;AAC1B,MAAG,IAAH,EAAS,IAAT,EAD0B;AAE1B,UAF0B;GAA3B;;AAKA,MAAI,OAAO,CAAC,OAAD,EAAU,MAAV,EAAkB,WAAlB,CAAP,CAhB4D;AAiBhE,MAAI,MAAM,EAAN,CAjB4D;AAkBhE,MAAI,MAAM,CAAN,CAlB4D;AAmBhE,MAAI,MAAM,EAAN,CAnB4D;;AAqBhE,MAAI,KAAK,WAAL,EAAkB;AACrB,QAAK,IAAL,CAAU,cAAV,EADqB;GAAtB;;AAIA,MAAI,KAAK,UAAL,EAAiB;AACpB,QAAK,IAAL,CAAU,aAAV,EADoB;GAArB;;AAIA,MAAI,KAAK,MAAM,QAAN,EAAgB,IAAhB,CAAL,CA7B4D;;AA+BhE,KAAG,MAAH,CAAU,WAAV,CAAsB,MAAtB,EA/BgE;AAgChE,KAAG,MAAH,CAAU,EAAV,CAAa,MAAb,EAAqB,UAAU,IAAV,EAAgB;AACpC,UAAO,IAAP,CADoC;GAAhB,CAArB,CAhCgE;;AAoChE,KAAG,MAAH,CAAU,EAAV,CAAa,MAAb,EAAqB,UAAU,IAAV,EAAgB;AACpC,OAAI,IAAJ,CAAS,IAAT,EADoC;AAEpC,UAAO,KAAK,MAAL,CAF6B;GAAhB,CAArB,CApCgE;;AAyChE,KAAG,EAAH,CAAM,OAAN,EAAe,UAAU,GAAV,EAAe;AAC7B,OAAI,QAAJ,GAAe,KAAK,IAAL,CADc;AAE7B,MAAG,GAAH,EAF6B;AAG7B,UAH6B;GAAf,CAAf,CAzCgE;;AA+ChE,KAAG,EAAH,CAAM,OAAN,EAAe,YAAY;AAC1B,OAAI,WAAW,OAAO,MAAP,CAAc,GAAd,EAAmB,GAAnB,CAAX,CADsB;;AAG1B,OAAI,QAAQ,IAAI,IAAJ,KAAa,OAAb,IAAwB,CAAC,MAAM,QAAN,CAAD,CAAhC,EAAmD;AACtD,UAAM,OAAO,GAAP,KAAe,QAAf,GAA0B,IAAI,KAAJ,CAAU,GAAV,CAA1B,GAA2C,GAA3C,CADgD;AAEtD,QAAI,QAAJ,GAAe,KAAK,IAAL,CAFuC;AAGtD,OAAG,GAAH,EAHsD;AAItD,WAJsD;IAAvD;;AAOA,OAAI,MAAM,KAAK,QAAL,CAAc,MAAd,EAAsB;AAC/B,SAAK,QAAL,GAAgB,QAAhB,CAD+B;IAAhC;;AAIA,MAAG,IAAH,EAAS,IAAT,EAd0B;GAAZ,CAAf,CA/CgE;;AAgEhE,KAAG,KAAH,CAAS,EAAT,CAAY,OAAZ,EAAqB,UAAU,QAAV,EAAoB;AACxC,OAAI,CAAC,GAAD,EAAM;AACT,UAAM,QAAN,CADS;IAAV;GADoB,CAArB,CAhEgE;;AAsEhE,KAAG,KAAH,CAAS,GAAT,CAAa,KAAK,QAAL,CAAb,CAtEgE;EAAzB,CAAxC,CAHgC;CAAhB","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar spawn = require('child_process').spawn;\nvar isJpg = require('is-jpg');\nvar jpegtran = require('jpegtran-bin');\nvar through = require('through2');\n\nmodule.exports = function (opts) {\n\topts = opts || {};\n\n\treturn through.ctor({objectMode: true}, function (file, enc, cb) {\n\t\tif (file.isNull()) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tif (file.isStream()) {\n\t\t\tcb(new Error('Streaming is not supported'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isJpg(file.contents)) {\n\t\t\tcb(null, file);\n\t\t\treturn;\n\t\t}\n\n\t\tvar args = ['-copy', 'none', '-optimize'];\n\t\tvar ret = [];\n\t\tvar len = 0;\n\t\tvar err = '';\n\n\t\tif (opts.progressive) {\n\t\t\targs.push('-progressive');\n\t\t}\n\n\t\tif (opts.arithmetic) {\n\t\t\targs.push('-arithmetic');\n\t\t}\n\n\t\tvar cp = spawn(jpegtran, args);\n\n\t\tcp.stderr.setEncoding('utf8');\n\t\tcp.stderr.on('data', function (data) {\n\t\t\terr += data;\n\t\t});\n\n\t\tcp.stdout.on('data', function (data) {\n\t\t\tret.push(data);\n\t\t\tlen += data.length;\n\t\t});\n\n\t\tcp.on('error', function (err) {\n\t\t\terr.fileName = file.path;\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t});\n\n\t\tcp.on('close', function () {\n\t\t\tvar contents = Buffer.concat(ret, len);\n\n\t\t\tif (err && (err.code !== 'EPIPE' || !isJpg(contents))) {\n\t\t\t\terr = typeof err === 'string' ? new Error(err) : err;\n\t\t\t\terr.fileName = file.path;\n\t\t\t\tcb(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (len < file.contents.length) {\n\t\t\t\tfile.contents = contents;\n\t\t\t}\n\n\t\t\tcb(null, file);\n\t\t});\n\n\t\tcp.stdin.on('error', function (stdinErr) {\n\t\t\tif (!err) {\n\t\t\t\terr = stdinErr;\n\t\t\t}\n\t\t});\n\n\t\tcp.stdin.end(file.contents);\n\t});\n};\n"]}