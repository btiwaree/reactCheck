{"version":3,"sources":["moveElemsAttrsToGroup.js"],"names":[],"mappings":"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","file":"moveElemsAttrsToGroup-compiled.js","sourcesContent":["'use strict';\n\nexports.type = 'perItemReverse';\n\nexports.active = true;\n\nexports.description = 'moves elements attributes to the existing group wrapper';\n\nvar inheritableAttrs = require('./_collections').inheritableAttrs,\n    pathElems = require('./_collections.js').pathElems;\n\n/**\n * Collapse content's intersected and inheritable\n * attributes to the existing group wrapper.\n *\n * @example\n * <g attr1=\"val1\">\n *     <g attr2=\"val2\">\n *         text\n *     </g>\n *     <circle attr2=\"val2\" attr3=\"val3\"/>\n * </g>\n *              â¬‡\n * <g attr1=\"val1\" attr2=\"val2\">\n *     <g>\n *         text\n *     </g>\n *    <circle attr3=\"val3\"/>\n * </g>\n *\n * @param {Object} item current iteration item\n * @return {Boolean} if false, item will be filtered out\n *\n * @author Kir Belevich\n */\nexports.fn = function(item) {\n\n    if (item.isElem('g') && !item.isEmpty() && item.content.length > 1) {\n\n        var intersection = {},\n            hasTransform = false,\n            hasClip = item.hasAttr('clip-path') || item.hasAttr('mask'),\n            intersected = item.content.every(function(inner) {\n                if (inner.isElem() && inner.hasAttr()) {\n                    // don't mess with possible styles (hack until CSS parsing is implemented)\n                    if (inner.hasAttr('class')) return false;\n                    if (!Object.keys(intersection).length) {\n                        intersection = inner.attrs;\n                    } else {\n                        intersection = intersectInheritableAttrs(intersection, inner.attrs);\n\n                        if (!intersection) return false;\n                    }\n\n                    return true;\n                }\n            }),\n            allPath = item.content.every(function(inner) {\n                return inner.isElem(pathElems);\n            });\n\n        if (intersected) {\n\n            item.content.forEach(function(g) {\n\n                for (var name in intersection) {\n\n                    if (!allPath && !hasClip || name !== 'transform') {\n\n                        g.removeAttr(name);\n\n                        if (name === 'transform') {\n                            if (!hasTransform) {\n                                if (item.hasAttr('transform')) {\n                                    item.attr('transform').value += ' ' + intersection[name].value;\n                                } else {\n                                    item.addAttr(intersection[name]);\n                                }\n\n                                hasTransform = true;\n                            }\n                        } else {\n                            item.addAttr(intersection[name]);\n                        }\n\n                    }\n                }\n\n            });\n\n        }\n\n    }\n\n};\n\n/**\n * Intersect inheritable attributes.\n *\n * @param {Object} a first attrs object\n * @param {Object} b second attrs object\n *\n * @return {Object} intersected attrs object\n */\nfunction intersectInheritableAttrs(a, b) {\n\n    var c = {};\n\n    for (var n in a) {\n        if (\n            b.hasOwnProperty(n) &&\n            inheritableAttrs.indexOf(n) > -1 &&\n            a[n].name === b[n].name &&\n            a[n].value === b[n].value &&\n            a[n].prefix === b[n].prefix &&\n            a[n].local === b[n].local\n        ) {\n            c[n] = a[n];\n        }\n    }\n\n    if (!Object.keys(c).length) return false;\n\n    return c;\n\n}\n"]}