{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\nvar path = require('path');\nvar url = require('url');\nvar caw = require('caw');\nvar concatStream = require('concat-stream');\nvar decompress = require('gulp-decompress');\nvar eachAsync = require('each-async');\nvar filenamify = require('filenamify');\nvar got = require('got');\nvar isUrl = require('is-url');\nvar objectAssign = require('object-assign');\nvar readAllStream = require('read-all-stream');\nvar rename = require('gulp-rename');\nvar streamCombiner = require('stream-combiner2');\nvar PassThrough = require('readable-stream/passthrough');\nvar Vinyl = require('vinyl');\nvar vinylFs = require('vinyl-fs');\nvar Ware = require('ware');\n\n/**\n * Initialize a new `Download`\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction Download(opts) {\n\tif (!(this instanceof Download)) {\n\t\treturn new Download(opts);\n\t}\n\n\tthis.opts = objectAssign({encoding: null}, opts);\n\tthis.ware = new Ware();\n}\n\nmodule.exports = Download;\n\n/**\n * Get or set URL to download\n *\n * @param {String} url\n * @param {String} dest\n * @api public\n */\n\nDownload.prototype.get = function (url, dest) {\n\tif (!arguments.length) {\n\t\treturn this._get;\n\t}\n\n\tthis._get = this._get || [];\n\tthis._get.push({\n\t\turl: url,\n\t\tdest: dest\n\t});\n\n\treturn this;\n};\n\n/**\n * Get or set the destination folder\n *\n * @param {String} dir\n * @api public\n */\n\nDownload.prototype.dest = function (dir) {\n\tif (!arguments.length) {\n\t\treturn this._dest;\n\t}\n\n\tthis._dest = dir;\n\treturn this;\n};\n\n/**\n * Rename the downloaded file\n *\n * @param {Function|String} name\n * @api public\n */\n\nDownload.prototype.rename = function (name) {\n\tif (!arguments.length) {\n\t\treturn this._rename;\n\t}\n\n\tthis._rename = name;\n\treturn this;\n};\n\n/**\n * Add a plugin to the middleware stack\n *\n * @param {Function} plugin\n * @api public\n */\n\nDownload.prototype.use = function (plugin) {\n\tthis.ware.use(plugin);\n\treturn this;\n};\n\n/**\n * Run\n *\n * @param {Function} cb\n * @api public\n */\n\nDownload.prototype.run = function (cb) {\n\tcb = cb || function () {};\n\tvar files = [];\n\n\teachAsync(this.get(), function (get, i, done) {\n\t\tif (!isUrl(get.url)) {\n\t\t\tdone(new Error('Specify a valid URL'));\n\t\t\treturn;\n\t\t}\n\n\t\tvar protocol = url.parse(get.url).protocol;\n\t\tif (protocol) {\n\t\t\tprotocol = protocol.slice(0, -1);\n\t\t}\n\t\tvar agent = caw(this.opts.proxy, {protocol: protocol});\n\t\tvar stream = got.stream(get.url, objectAssign(this.opts, {agent: agent}));\n\n\t\tstream.on('response', function (res) {\n\t\t\tstream.headers = res.headers;\n\t\t\tstream.statusCode = res.statusCode;\n\t\t\tthis.ware.run(stream, get.url);\n\t\t}.bind(this));\n\n\t\tvar hasHttpError = false;\n\n\t\treadAllStream(stream, null, function (err, data) {\n\t\t\tif (hasHttpError) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (err) {\n\t\t\t\tif (err instanceof got.HTTPError) {\n\t\t\t\t\thasHttpError = true;\n\t\t\t\t}\n\n\t\t\t\tdone(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar dest = get.dest || this.dest();\n\t\t\tvar fileStream = this.createStream(this.createFile(get.url, data), dest);\n\n\t\t\tfileStream.on('error', done);\n\t\t\tfileStream.pipe(concatStream({encoding: 'object'}, function (items) {\n\t\t\t\tfiles = files.concat(items);\n\t\t\t\tdone();\n\t\t\t}));\n\t\t}.bind(this));\n\t}.bind(this), function (err) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\tcb(null, files);\n\t});\n};\n\n/**\n * Create vinyl file\n *\n * @param {String} url\n * @param {Buffer} data\n * @api private\n */\n\nDownload.prototype.createFile = function (url, data) {\n\treturn objectAssign(new Vinyl({\n\t\tcontents: data,\n\t\tpath: filenamify(path.basename(url))\n\t}), {url: url});\n};\n\n/**\n * Create stream\n *\n * @param {Object} file\n * @param {String} dest\n * @api private\n */\n\nDownload.prototype.createStream = function (file, dest) {\n\tvar stream = new PassThrough({objectMode: true});\n\tvar streams = [stream];\n\n\tstream.end(file);\n\n\tif (this.opts.extract) {\n\t\tstreams.push(decompress(this.opts));\n\t}\n\n\tif (this.rename()) {\n\t\tstreams.push(rename(this.rename()));\n\t}\n\n\tif (dest) {\n\t\tstreams.push(vinylFs.dest(dest, this.opts));\n\t}\n\n\treturn streamCombiner.obj(streams);\n};\n"]}