{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar execFile = require('child_process').execFile;\nvar fs = require('fs');\nvar rm = require('rimraf');\nvar tempfile = require('tempfile');\n\n/**\n * Run a buffer through a child process\n *\n * @api public\n */\n\nfunction ExecBuffer() {\n\tif (!(this instanceof ExecBuffer)) {\n\t\treturn new ExecBuffer();\n\t}\n\n\tthis.src(tempfile());\n\tthis.dest(tempfile());\n}\n\n/**\n * Add a child process to use\n *\n * @param {String} bin\n * @param {Array} args\n * @api public\n */\n\nExecBuffer.prototype.use = function (bin, args) {\n\tif (!arguments.length) {\n\t\treturn this._use;\n\t}\n\n\tthis._use = {\n\t\targs: args,\n\t\tbin: bin\n\t};\n\n\treturn this;\n};\n\n/**\n * Get or set the temp source path\n *\n * @param {String} path\n * @api public\n */\n\nExecBuffer.prototype.src = function (path) {\n\tif (!arguments.length) {\n\t\treturn this._src;\n\t}\n\n\tthis._src = path;\n\treturn this;\n};\n\n/**\n * Get or set the temp destination path\n *\n * @param {String} path\n * @api public\n */\n\nExecBuffer.prototype.dest = function (path) {\n\tif (!arguments.length) {\n\t\treturn this._dest;\n\t}\n\n\tthis._dest = path;\n\treturn this;\n};\n\n/**\n * Run buffer through the child process\n *\n * @param {Buffer} buf\n * @param {Function} cb\n * @api public\n */\n\nExecBuffer.prototype.run = function (buf, cb) {\n\tfs.writeFile(this.src(), buf, function (err) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\texecFile(this.use().bin, this.use().args, function (err, stdout, stderr) {\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfs.readFile(this.dest(), function (err, data) {\n\t\t\t\tif (err) {\n\t\t\t\t\tcb(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.cleanup(function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tcb(err);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcb(null, data, stderr);\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}.bind(this));\n};\n\n/**\n * Cleanup temporary files\n *\n * @param {Function} cb\n * @api private\n */\n\nExecBuffer.prototype.cleanup = function (cb) {\n\trm(this.src(), function (err) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\trm(this.dest(), function (err) {\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcb();\n\t\t});\n\t}.bind(this));\n};\n\n/**\n * Module exports\n */\n\nmodule.exports = ExecBuffer;\n"]}