{"version":3,"sources":["sink.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,WAAW,QAAQ,0BAAR,CAAX;;AAEJ,SAAS,aAAT,CAAuB,MAAvB,EAA+B,GAA/B,EAAoC;AAClC,SAAO,OAAO,SAAP,CAAiB,GAAjB,EAAsB,MAAtB,CAD2B;CAApC;;AAIA,SAAS,YAAT,CAAsB,MAAtB,EAA8B;AAC5B,SAAO,CAAC,EAAE,cAAc,MAAd,EAAsB,UAAtB,KAAqC,cAAc,MAAd,EAAsB,MAAtB,CAArC,CAAF,CADoB;CAA9B;;AAIA,SAAS,IAAT,CAAc,MAAd,EAAsB;AACpB,MAAI,YAAY,KAAZ,CADgB;AAEpB,MAAI,aAAa,IAAI,QAAJ,CAAa;AAC5B,gBAAY,IAAZ;AACA,WAAO,UAAS,IAAT,EAAe,GAAf,EAAoB,EAApB,EAAwB;AAC7B,WAD6B;KAAxB;GAFQ,CAAb,CAFgB;;AASpB,WAAS,OAAT,GAAmB;AACjB,QAAI,SAAJ,EAAe;AACb,aADa;KAAf;;AAIA,QAAI,aAAa,MAAb,CAAJ,EAA0B;AACxB,aADwB;KAA1B;;AAIA,gBAAY,IAAZ,CATiB;AAUjB,WAAO,IAAP,CAAY,UAAZ,EAViB;GAAnB;;AAaA,WAAS,UAAT,CAAoB,GAApB,EAAyB;AACvB,QAAI,QAAQ,UAAR,IAAsB,QAAQ,MAAR,EAAgB;AACxC,aADwC;KAA1C;;AAIA,QAAI,aAAa,MAAb,CAAJ,EAA0B;AACxB,kBAAY,KAAZ,CADwB;AAExB,aAAO,MAAP,CAAc,UAAd,EAFwB;KAA1B;GALF;;AAWA,SAAO,EAAP,CAAU,aAAV,EAAyB,UAAzB,EAjCoB;AAkCpB,SAAO,EAAP,CAAU,gBAAV,EAA4B,UAA5B,EAlCoB;AAmCpB,SAAO,EAAP,CAAU,gBAAV,EAA4B,OAA5B,EAnCoB;;AAqCpB,SAAO,OAAP,CArCoB;CAAtB;;AAwCA,OAAO,OAAP,GAAiB,IAAjB","file":"sink-compiled.js","sourcesContent":["'use strict';\n\nvar Writable = require('readable-stream/writable');\n\nfunction listenerCount(stream, evt) {\n  return stream.listeners(evt).length;\n}\n\nfunction hasListeners(stream) {\n  return !!(listenerCount(stream, 'readable') || listenerCount(stream, 'data'));\n}\n\nfunction sink(stream) {\n  var sinkAdded = false;\n  var sinkStream = new Writable({\n    objectMode: true,\n    write: function(file, enc, cb) {\n      cb();\n    },\n  });\n\n  function addSink() {\n    if (sinkAdded) {\n      return;\n    }\n\n    if (hasListeners(stream)) {\n      return;\n    }\n\n    sinkAdded = true;\n    stream.pipe(sinkStream);\n  }\n\n  function removeSink(evt) {\n    if (evt !== 'readable' && evt !== 'data') {\n      return;\n    }\n\n    if (hasListeners(stream)) {\n      sinkAdded = false;\n      stream.unpipe(sinkStream);\n    }\n  }\n\n  stream.on('newListener', removeSink);\n  stream.on('removeListener', removeSink);\n  stream.on('removeListener', addSink);\n\n  return addSink;\n}\n\nmodule.exports = sink;\n"]}