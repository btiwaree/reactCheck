{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var stream = require('readable-stream')\nvar eos = require('end-of-stream')\nvar inherits = require('inherits')\n\nvar SIGNAL_FLUSH = new Buffer([0])\n\nvar onuncork = function(self, fn) {\n  if (self._corked) self.once('uncork', fn)\n  else fn()\n}\n\nvar destroyer = function(self, end) {\n  return function(err) {\n    if (err) self.destroy(err.message === 'premature close' ? null : err)\n    else if (end && !self._ended) self.end()\n  }\n}\n\nvar end = function(ws, fn) {\n  if (!ws) return fn()\n  if (ws._writableState && ws._writableState.finished) return fn()\n  if (ws._writableState) return ws.end(fn)\n  ws.end()\n  fn()\n}\n\nvar toStreams2 = function(rs) {\n  return new (stream.Readable)({objectMode:true, highWaterMark:16}).wrap(rs)\n}\n\nvar Duplexify = function(writable, readable, opts) {\n  if (!(this instanceof Duplexify)) return new Duplexify(writable, readable, opts)\n  stream.Duplex.call(this, opts)\n\n  this._writable = null\n  this._readable = null\n  this._readable2 = null\n\n  this._forwardDestroy = !opts || opts.destroy !== false\n  this._forwardEnd = !opts || opts.end !== false\n  this._corked = 1 // start corked\n  this._ondrain = null\n  this._drained = false\n  this._forwarding = false\n  this._unwrite = null\n  this._unread = null\n  this._ended = false\n\n  this.destroyed = false\n\n  if (writable) this.setWritable(writable)\n  if (readable) this.setReadable(readable)\n}\n\ninherits(Duplexify, stream.Duplex)\n\nDuplexify.obj = function(writable, readable, opts) {\n  if (!opts) opts = {}\n  opts.objectMode = true\n  opts.highWaterMark = 16\n  return new Duplexify(writable, readable, opts)\n}\n\nDuplexify.prototype.cork = function() {\n  if (++this._corked === 1) this.emit('cork')\n}\n\nDuplexify.prototype.uncork = function() {\n  if (this._corked && --this._corked === 0) this.emit('uncork')\n}\n\nDuplexify.prototype.setWritable = function(writable) {\n  if (this._unwrite) this._unwrite()\n\n  if (this.destroyed) {\n    if (writable && writable.destroy) writable.destroy()\n    return\n  }\n\n  if (writable === null || writable === false) {\n    this.end()\n    return\n  }\n\n  var self = this\n  var unend = eos(writable, {writable:true, readable:false}, destroyer(this, this._forwardEnd))\n\n  var ondrain = function() {\n    var ondrain = self._ondrain\n    self._ondrain = null\n    if (ondrain) ondrain()\n  }\n\n  var clear = function() {\n    self._writable.removeListener('drain', ondrain)\n    unend()\n  }\n\n  if (this._unwrite) process.nextTick(ondrain) // force a drain on stream reset to avoid livelocks\n\n  this._writable = writable\n  this._writable.on('drain', ondrain)\n  this._unwrite = clear\n\n  this.uncork() // always uncork setWritable\n}\n\nDuplexify.prototype.setReadable = function(readable) {\n  if (this._unread) this._unread()\n\n  if (this.destroyed) {\n    if (readable && readable.destroy) readable.destroy()\n    return\n  }\n\n  if (readable === null || readable === false) {\n    this.push(null)\n    this.resume()\n    return\n  }\n\n  var self = this\n  var unend = eos(readable, {writable:false, readable:true}, destroyer(this))\n\n  var onreadable = function() {\n    self._forward()\n  }\n\n  var onend = function() {\n    self.push(null)\n  }\n\n  var clear = function() {\n    self._readable2.removeListener('readable', onreadable)\n    self._readable2.removeListener('end', onend)\n    unend()\n  }\n\n  this._drained = true\n  this._readable = readable\n  this._readable2 = readable._readableState ? readable : toStreams2(readable)\n  this._readable2.on('readable', onreadable)\n  this._readable2.on('end', onend)\n  this._unread = clear\n\n  this._forward()\n}\n\nDuplexify.prototype._read = function() {\n  this._drained = true\n  this._forward()\n}\n\nDuplexify.prototype._forward = function() {\n  if (this._forwarding || !this._readable2 || !this._drained) return\n  this._forwarding = true\n\n  var data\n  var state = this._readable2._readableState\n\n  while ((data = this._readable2.read(state.buffer.length ? state.buffer[0].length : state.length)) !== null) {\n    this._drained = this.push(data)\n  }\n\n  this._forwarding = false\n}\n\nDuplexify.prototype.destroy = function(err) {\n  if (this.destroyed) return\n  this.destroyed = true\n\n  var self = this\n  process.nextTick(function() {\n    self._destroy(err)\n  })\n}\n\nDuplexify.prototype._destroy = function(err) {\n  if (err) {\n    var ondrain = this._ondrain\n    this._ondrain = null\n    if (ondrain) ondrain(err)\n    else this.emit('error', err)\n  }\n\n  if (this._forwardDestroy) {\n    if (this._readable && this._readable.destroy) this._readable.destroy()\n    if (this._writable && this._writable.destroy) this._writable.destroy()\n  }\n\n  this.emit('close')\n}\n\nDuplexify.prototype._write = function(data, enc, cb) {\n  if (this.destroyed) return cb()\n  if (this._corked) return onuncork(this, this._write.bind(this, data, enc, cb))\n  if (data === SIGNAL_FLUSH) return this._finish(cb)\n  if (!this._writable) return cb()\n\n  if (this._writable.write(data) === false) this._ondrain = cb\n  else cb()\n}\n\n\nDuplexify.prototype._finish = function(cb) {\n  var self = this\n  this.emit('preend')\n  onuncork(this, function() {\n    end(self._forwardEnd && self._writable, function() {\n      // haxx to not emit prefinish twice\n      if (self._writableState.prefinished === false) self._writableState.prefinished = true\n      self.emit('prefinish')\n      onuncork(self, cb)\n    })\n  })\n}\n\nDuplexify.prototype.end = function(data, enc, cb) {\n  if (typeof data === 'function') return this.end(null, null, data)\n  if (typeof enc === 'function') return this.end(data, null, enc)\n  this._ended = true\n  if (data) this.write(data)\n  if (!this._writableState.ending) this.write(SIGNAL_FLUSH)\n  return stream.Writable.prototype.end.call(this, cb)\n}\n\nmodule.exports = Duplexify\n"]}