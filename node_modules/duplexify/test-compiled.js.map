{"version":3,"sources":["test.js"],"names":[],"mappings":"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","file":"test-compiled.js","sourcesContent":["var tape = require('tape')\nvar through = require('through2')\nvar concat = require('concat-stream')\nvar duplexify = require('./')\n\ntape('passthrough', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('passthrough + double end', function(t) {\n  t.plan(2)\n\n  var pt = through()\n  var dup = duplexify(pt, pt)\n\n  dup.end('hello world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('async passthrough + end', function(t) {\n  t.plan(2)\n\n  var pt = through.obj({highWaterMark:1}, function(data, enc, cb) {\n    setTimeout(function() {\n      cb(null, data)\n    }, 100)\n  })\n\n  var dup = duplexify(pt, pt)\n\n  dup.write('hello ')\n  dup.write('world')\n  dup.end()\n\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'hello world', 'same in as out')\n  }))\n})\n\ntape('duplex', function(t) {\n  var readExpected = ['read-a', 'read-b', 'read-c']\n  var writeExpected = ['write-a', 'write-b', 'write-c']\n\n  t.plan(readExpected.length+writeExpected.length+2)\n\n  var readable = through.obj()\n  var writable = through.obj(function(data, enc, cb) {\n    t.same(data, writeExpected.shift(), 'onwrite should match')\n    cb()\n  })\n\n  var dup = duplexify.obj(writable, readable)\n\n  readExpected.slice().forEach(function(data) {\n    readable.write(data)\n  })\n  readable.end()\n\n  writeExpected.slice().forEach(function(data) {\n    dup.write(data)\n  })\n  dup.end()\n\n  dup.on('data', function(data) {\n    t.same(data, readExpected.shift(), 'ondata should match')\n  })\n  dup.on('end', function() {\n    t.ok(true, 'should end')\n  })\n  dup.on('finish', function() {\n    t.ok(true, 'should finish')\n  })\n})\n\ntape('async', function(t) {\n  var dup = duplexify()\n  var pt = through()\n\n  dup.pipe(concat(function(data) {\n    t.same(data.toString(), 'i was async', 'same in as out')\n    t.end()\n  }))\n\n  dup.write('i')\n  dup.write(' was ')\n  dup.end('async')\n\n  setTimeout(function() {\n    dup.setWritable(pt)\n    setTimeout(function() {\n      dup.setReadable(pt)\n    }, 50)\n  }, 50)\n})\n\ntape('destroy', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('destroy both', function(t) {\n  t.plan(3)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  write.destroy = function() {\n    t.ok(true, 'write destroyed')\n  }\n\n  read.destroy = function() {\n    t.ok(true, 'read destroyed')\n  }\n\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  dup.destroy()\n  dup.destroy() // should only work once\n})\n\ntape('bubble read errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'read-error', 'received read error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  read.emit('error', new Error('read-error'))\n  write.emit('error', new Error('write-error')) // only emit first error\n})\n\ntape('bubble write errors', function(t) {\n  t.plan(2)\n\n  var write = through()\n  var read = through()\n  var dup = duplexify(write, read)\n\n  dup.on('error', function(err) {\n    t.same(err.message, 'write-error', 'received write error')\n  })\n  dup.on('close', function() {\n    t.ok(true, 'close emitted')\n  })\n\n  write.emit('error', new Error('write-error'))\n  read.emit('error', new Error('read-error')) // only emit first error\n})\n\ntape('reset writable / readable', function(t) {\n  t.plan(3)\n\n  var toUpperCase = function(data, enc, cb) {\n    cb(null, data.toString().toUpperCase())\n  }\n\n  var passthrough = through()\n  var upper = through(toUpperCase)\n  var dup = duplexify(passthrough, passthrough)\n\n  dup.once('data', function(data) {\n    t.same(data.toString(), 'hello')\n    dup.setWritable(upper)\n    dup.setReadable(upper)\n    dup.once('data', function(data) {\n      t.same(data.toString(), 'HELLO')\n      dup.once('data', function(data) {\n        t.same(data.toString(), 'HI')\n        t.end()\n      })\n    })\n    dup.write('hello')\n    dup.write('hi')\n  })\n  dup.write('hello')\n})\n\ntape('cork', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var ok = false\n\n  dup.on('prefinish', function() {\n    dup.cork()\n    setTimeout(function() {\n      ok = true\n      dup.uncork()\n    }, 100)\n  })\n  dup.on('finish', function() {\n    t.ok(ok)\n    t.end()\n  })\n  dup.end()\n})\n\ntape('prefinish not twice', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var prefinished = false\n\n  dup.on('prefinish', function() {\n    t.ok(!prefinished, 'only prefinish once')\n    prefinished = true\n  })\n\n  dup.on('finish', function() {\n    t.end()\n  })\n\n  dup.end()\n})\n\ntape('close', function(t) {\n  var passthrough = through()\n  var dup = duplexify(passthrough, passthrough)\n  var ok = false\n\n  passthrough.emit('close')\n  dup.on('close', function() {\n    t.ok(true, 'should forward close')\n    t.end()\n  })\n})"]}