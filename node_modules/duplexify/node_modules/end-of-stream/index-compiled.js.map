{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var once = require('once');\n\nvar noop = function() {};\n\nvar isRequest = function(stream) {\n\treturn stream.setHeader && typeof stream.abort === 'function';\n};\n\nvar eos = function(stream, opts, callback) {\n\tif (typeof opts === 'function') return eos(stream, null, opts);\n\tif (!opts) opts = {};\n\n\tcallback = once(callback || noop);\n\n\tvar ws = stream._writableState;\n\tvar rs = stream._readableState;\n\tvar readable = opts.readable || (opts.readable !== false && stream.readable);\n\tvar writable = opts.writable || (opts.writable !== false && stream.writable);\n\n\tvar onlegacyfinish = function() {\n\t\tif (!stream.writable) onfinish();\n\t};\n\n\tvar onfinish = function() {\n\t\twritable = false;\n\t\tif (!readable) callback();\n\t};\n\n\tvar onend = function() {\n\t\treadable = false;\n\t\tif (!writable) callback();\n\t};\n\n\tvar onclose = function() {\n\t\tif (readable && !(rs && rs.ended)) return callback(new Error('premature close'));\n\t\tif (writable && !(ws && ws.ended)) return callback(new Error('premature close'));\n\t};\n\n\tvar onrequest = function() {\n\t\tstream.req.on('finish', onfinish);\n\t};\n\n\tif (isRequest(stream)) {\n\t\tstream.on('complete', onfinish);\n\t\tstream.on('abort', onclose);\n\t\tif (stream.req) onrequest();\n\t\telse stream.on('request', onrequest);\n\t} else if (writable && !ws) { // legacy streams\n\t\tstream.on('end', onlegacyfinish);\n\t\tstream.on('close', onlegacyfinish);\n\t}\n\n\tstream.on('end', onend);\n\tstream.on('finish', onfinish);\n\tif (opts.error !== false) stream.on('error', callback);\n\tstream.on('close', onclose);\n\n\treturn function() {\n\t\tstream.removeListener('complete', onfinish);\n\t\tstream.removeListener('abort', onclose);\n\t\tstream.removeListener('request', onrequest);\n\t\tif (stream.req) stream.req.removeListener('finish', onfinish);\n\t\tstream.removeListener('end', onlegacyfinish);\n\t\tstream.removeListener('close', onlegacyfinish);\n\t\tstream.removeListener('finish', onfinish);\n\t\tstream.removeListener('end', onend);\n\t\tstream.removeListener('error', callback);\n\t\tstream.removeListener('close', onclose);\n\t};\n};\n\nmodule.exports = eos;"]}